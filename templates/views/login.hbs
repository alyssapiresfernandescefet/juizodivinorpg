<!DOCTYPE html>
<html>

<head>
    {{> head ignore_socketio=1}}
</head>

<body>
    <div class="container text-center">
        <div class="row my-4">
            <div class="col">
                <h1>Entrar</h1>
                <form id="loginForm">
                    <div class="row my-3">
                        <div class="col-6 offset-3">
                            <input class="form-control acds-element text-center" type="text" placeholder="Login"
                                id="username" name="username" required>
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-6 offset-3">
                            <input class="form-control acds-element text-center" type="password" placeholder="Senha"
                                id="password" name="password" required>
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col">
                            <input class="btn btn-primary" type="submit" value="Entrar" />
                        </div>
                    </div>
                </form>
                <div class="row my-3">
                    <div class="col">
                        NÃ£o possui cadastro? <a class="h5" href="/register">Registrar-se</a>
                    </div>
                </div>
                <div class="row my-3">
                    <div class="col">
                        <a class="h5" href="/">Voltar</a>
                    </div>
                </div>
                <div class="row">
                    <div class="col return">

                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
        const loginForm = $('#loginForm');
        loginForm.submit(async ev => {
            ev.preventDefault();

            loginForm.hide();

            const pass = $('#password');

            const username = $('#username').val();
            const password = pass.val();
            pass.val('');

            let responseElement;
            try {
                const response = await axios.post('/login', { username, password });
                
                responseElement = $('<p style="color: green;" class="h4">Logado com sucesso! ' +
                    'Redirecionando para a ficha...</p>');

                setTimeout(() => {
                    let url = response.data.admin ? '/sheet/admin/1' : '/sheet/1';
                    location.replace(url);
                }, 1000);
            }
            catch (err) {
                responseElement = $(`<p style="color: red;" class="h4">Erro: ${err.message} - ${err.response.data}</p>`);

                setTimeout(() => {
                    error.fadeOut(2000, () => error.remove());
                }, 500);
                console.error(err);
            }
            loginForm.show();
            $('.col.return').append(responseElement);
        });

    </script>
</body>

</html>